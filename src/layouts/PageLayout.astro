---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '@/config';

export const getStaticPaths: GetStaticPaths = async () => {
  const pages = await getCollection('pages');
  const specialPages = await getCollection('special');

  const specialPageSlugs = ['home', '404'];
  const visiblePages = pages.filter(page => !specialPageSlugs.includes(page.slug));

  const pagePaths = visiblePages.map(page => ({
    params: { slug: page.slug },
    props: { page }
  }));

  const specialPaths = specialPages
    .filter(page => {
      if (['home', '404'].includes(page.slug)) return false;
      if (page.slug === 'projects') return !siteConfig.optionalContentTypes.projects;
      if (page.slug === 'docs') return !siteConfig.optionalContentTypes.docs;
      return true;
    })
    .map(page => ({
      params: { slug: page.slug },
      props: { page }
    }));

  return [...pagePaths, ...specialPaths];
};

const { page } = Astro.props;
---

<html>
  <head>
    <title>{page?.data?.title || '页面'}</title>
    <!-- 添加字符编码 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body style="padding: 20px; font-family: sans-serif;">
    <h1>页面测试 - 直接渲染</h1>
    <div style="background: #f0f0f0; padding: 15px; margin: 10px 0;">
      <p><strong>调试信息:</strong></p>
      <p>页面存在: <strong>{page ? '✅ 是' : '❌ 否'}</strong></p>
      <p>页面slug: <code>{page?.slug || '未找到'}</code></p>
      <p>页面标题: {page?.data?.title || '无标题'}</p>
      <p>当前路径: {Astro.url.pathname}</p>
    </div>
    <a href="/" style="color: blue;">返回首页</a>
  </body>
</html>